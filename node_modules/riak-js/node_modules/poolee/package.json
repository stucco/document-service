{
  "name": "poolee",
  "version": "0.4.9",
  "description": "HTTP pool and load balancer",
  "homepage": "http://github.com/dannycoates/poolee",
  "author": {
    "name": "Danny Coates",
    "email": "dannycoates@gmail.com"
  },
  "keywords": [
    "pool",
    "http",
    "retry",
    "health",
    "load balancer"
  ],
  "repository": {
    "type": "git",
    "url": "http://github.com/dannycoates/poolee.git"
  },
  "engines": {
    "node": ">=0.6.0"
  },
  "dependencies": {
    "keep-alive-agent": "*"
  },
  "scripts": {
    "test": "mocha -R spec -t 6000 test/*_test.js"
  },
  "devDependencies": {
    "mocha": "*"
  },
  "readme": "# poolee\n\nHTTP pool and load balancer for node.\n\n[![Build Status](https://travis-ci.org/dannycoates/poolee.png)](https://travis-ci.org/dannycoates/poolee)\n\n# Example\n\n```javascript\n\nvar Pool = require(\"poolee\")\nvar http = require(\"http\")\n\nvar servers =\n  [\"127.0.0.1:8886\"\n  ,\"127.0.0.1:8887\"\n  ,\"127.0.0.1:8888\"\n  ,\"127.0.0.1:8889\"]\n\nvar postData = '{\"name\":\"Danny Coates\"}'\n\nvar pool = new Pool(http, servers, options)\n\npool.request(\n  { method: \"PUT\"\n  , path: \"/users/me\"\n  }\n, postData\n, function (error, response, body) {\n    if (error) {\n      console.error(error.message)\n      return\n    }\n    if(response.statusCode === 201) {\n      console.log(\"put succeeded\")\n    }\n    else {\n      console.log(response.statusCode)\n      console.log(body)\n    }\n  }\n)\n```\n\n---\n\n# API\n\n## Pool\n\n### new\n\n```javascript\nvar Pool = require('poolee')\n//...\n\nvar pool = new Pool(\n  http                     // the http module to use (require('http') or require('https'))\n  ,\n  [ \"127.0.0.1:1337\"       // array of endpoints in \"host:port\" form\n  , \"127.0.0.1:1338\"\n  ]\n  ,                        // options\n  { maxPending: 1000       // maximum number of outstanding request to allow\n  , maxSockets: 200        // max sockets per endpoint Agent\n  , timeout: 60000         // request timeout in ms\n  , resolution: 1000       // timeout check interval (see below)\n  , keepAlive: false       // use an alternate Agent that does http keep-alive properly\n  , ping: undefined        // health check url\n  , pingTimeout: 2000      // ping timeout in ms\n  , retryFilter: undefined // see below\n  , retryDelay: 20         // see below\n  , maxRetries: 5          // see below\n  , name: undefined        // optional string\n  , agentOptions: undefined// an object for passing options directly to the Http Agent\n  }\n)\n```\n\n###### maxPending\n\nOnce this threshold is reached, requests will return an error to the callback as a\nsignal to slow down the rate of requests.\n\n###### resolution\n\nPending requests have their timeouts checked at this rate. If your timeout is 60000\nand resolution is 1000, the request will timeout no later than 60999\n\n###### keepAlive\n\nThe default http Agent does keep-alive in a stupid way. If you want it to work\nhow you'd expect it to set this to true.\n\n###### retryFilter\n\nAll valid http responses aren't necessarily a \"success\". This function lets you\ncheck the response before calling the request callback. Returning a \"truthy\" value\nwill retry the request.\n\nFor instance, we may want to always retry 500 responses by default:\n```javascript\noptions.retryFilter = function (\n    options  // the request.options\n  , response // the http response object\n  , body     // the response body\n  ) {\n  return response.statusCode === 500\n}\n```\n\nIf the returned value is `true` the next attempt will be delayed using exponential backoff;\nif its `Number` it will delay the next attempt by that many ms (useful for `Retry-After` headers)\n\n###### retryDelay\n\nPool uses exponential backoff when retrying requests. This value is a scaling factor of the\ntime (ms) to wait. Here's how it works:\n```javascript\nMath.random() * Math.pow(2, attemptNumber) * retryDelay\n```\nIf `retryDelay` is 20, attemptNumber 1 (the first retry) will delay at most 40ms\n\n###### maxRetries\n\nThe maximum number of attempts to make after the first request fails. This only\ntakes effect if maxRetries < pool size.\n\n###### agentOptions\n\nThese options are passed directly to the underlying Agents used in the pool. This\nis nice for passing options like `cert` and `key` that are required for client certificates.\n\n###### ping\n\nWhen an endpoint is unresponsive the pool will not use it for requests. The ping\nurl gives a downed endpoint a way to rejoin the pool. If an endpoint is marked unhealthy\nand a ping url is given, the endpoint will make requests to its ping url until it gets\na 200 response, based on the `resolution` time.\n\nIf the ping url is undefined, the endpoint will never be marked unhealthy.\n\n\n### pool.request\n\nAn http request. The pool sends the request to one of it's endpoints. If it\nfails, the pool may retry the request on other endpoints until it succeeds or\nreaches `options.attempts` number of tries. *When `data` is a Stream, only 1\nattempt will be made*\n\n###### Usage\n\n\nThe first argument may be a url path.\nIf the callback has 3 arguments the full response body will be returned\n\n```javascript\npool.request('/users/me', function (error, response, body) {})\n```\n\nThe first argument may be an options object.\nHere's the default values:\n\n```javascript\npool.request(\n  { path: undefined        // the request path (required)\n  , method: 'GET'\n  , data: undefined        // request body, may be a string, buffer, or stream\n  , headers: {}            // extra http headers to send\n  , retryFilter: undefined // see below\n  , attempts: pool.length  // or at least 2, at most options.maxRetries + 1\n  , retryDelay: 20         // retries wait with exponential backoff times this number of ms\n  , timeout: 60000         // ms to wait before timing out the request\n  , encoding: 'utf8'       // response body encoding\n  , stream: false          // stream instead of buffer response body\n  }\n  ,\n  function (error, response, body) {}\n)\n```\n\nThe request body may be the second argument, instead of options.data (more\nuseful with `pool.post` and `pool.put`)\n\n```javascript\npool.request(\n  { path: '/foo' }\n  , 'hi there'\n  , function (error, response, body) {}\n)\n```\n\nA callback with 2 arguments will stream the response and not buffer the\nresponse body.\n\n```javascript\npool.request('/foo', function (error, response) {\n  response.pipe(somewhere)\n})\n```\n\n### pool.get\n\nJust a synonym for `request`\n\n### pool.put\n\nSame arguments as `request` that sets `options.method = 'PUT'`. Nice for\nputting :)\n\n```javascript\npool.put('/tweet/me', 'Hello World!', function (error, response) {})\n```\n\n### pool.post\n\nSame arguments as `request` that sets `options.method = 'POST'`\n\n### pool.del\n\nSame arguments as `request` that sets `options.method = 'DELETE'`\n\n\n### Events\n\n##### timing\n\nEmits the request `duration` and `options` after each request\n\n##### retrying\n\nEmits the `error` of why a request is being retried\n\n##### timeout\n\nEmits the `request` when a request times out\n\n##### health\n\nEmits the `endpoint` when a node changes state between healthy/unhealthy\n",
  "readmeFilename": "readme.md",
  "bugs": {
    "url": "https://github.com/dannycoates/poolee/issues"
  },
  "_id": "poolee@0.4.9",
  "_from": "poolee@~0.4.8"
}
